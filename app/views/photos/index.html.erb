<div class="page-header">
  <div class="btn-group btn-group-justified" role="group" aria-label="...">
    <div class="btn-group" role="group">
      <a href="/photos/new" class="btn btn-lg btn-success"> + </a>
    </div>
  </div>

</div>

<% @photos.each do |photo| %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><a href="/users/<%= photo.user.id %>"><%= photo.user.username %></a></h3>
    <i><%= time_ago_in_words(photo.created_at) %> ago</i>
  </div>
  <div class="panel-body">
    <div><%= photo.image %></div>
    <div><%= photo.caption %></div>

    <!-- Likes -->
    <div>
      <% if photo.likes.count == 0 %>

        <!-- Hidden input for authenticity token to protect from forgery -->
        <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
        <div class="form-group">
          <input type="hidden" id="photo_id" name="photo_id" class="form-control" value="<%= photo.id %>">
          <input type="hidden" id="user_id" name="user_id" class="form-control" value="<%= current_user.id %>">
            </div>
            <a href="/create_like" method="post"><i class="fa fa-heart-o" aria-hidden="true"></i></a>

      <% else %>

      <% found = 0 %>
      <% photo.likes.each do |like| %>
      <% if like.user.id == current_user.id %>
      <form action="/delete_like/<%= like.id %>" method="get">
        <!-- Hidden input for authenticity token to protect from forgery -->
        <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

        <div class="form-group">
          <input type="hidden" id="photo_id" name="photo_id" class="form-control" value="<%= photo.id %>">
          <input type="hidden" id="user_id" name="user_id" class="form-control" value="<%= current_user.id %>">
            <i class="fa fa-heart" aria-hidden="true"></i>
            </div>
        </form>
      <% found = found + 1 %>
      <% elsif found == 0 %>
      <form action="/create_like" method="post">
        <!-- Hidden input for authenticity token to protect from forgery -->
        <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

        <div class="form-group">
          <input type="hidden" id="photo_id" name="photo_id" class="form-control" value="<%= photo.id %>">
          <input type="hidden" id="user_id" name="user_id" class="form-control" value="<%= current_user.id %>">
            </div>
            <i class="fa fa-heart-o" aria-hidden="true"></i>
        </form>
      <% end %>
      <% end %>

      <% photo.likes.each do |like| %>
      <%= like.user.username %>
      <% end %>
        <% end %>
    </div>



    <form action="/create_like" method="post">
      <!-- Hidden input for authenticity token to protect from forgery -->
      <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

      <div class="form-group">
        <input type="hidden" id="photo_id" name="photo_id" class="form-control" value="<%= photo.id %>">
        <input type="hidden" id="user_id" name="user_id" class="form-control" value="<%= current_user.id %>">
          </div>
      </form>


    <!-- Comments -->
    <div>
      <% photo.comments.each do |comment| %>
      <a href="/users/<%= comment.user.id %>"><%= comment.user.username %></a>
      <div>
        <%= comment.body %>
      </div>
      <% end %>
    </div>

    <!-- Add a comment -->
    <form action="/create_comment" method="post">
      <!-- Hidden input for authenticity token to protect from forgery -->
      <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

      <div class="form-group">
        <input type="hidden" id="photo_id" name="photo_id" class="form-control" value="<%= photo.id %>">
        <input type="hidden" id="user_id" name="user_id" class="form-control" value="<%= current_user.id %>">
        <input type="text" id="body" name="body" placeholder="Add a comment..." width="36">
        <button class="btn btn-sm btn-success">
          <i class="fa fa-comment-o" aria-hidden="true"></i>
        </button>
        </div>
      </form>

    <div>
      <% if photo.user_id == current_user.id %>
      <td>
        <a href="/photos/<%= photo.id %>" class="btn btn-primary">Show</a>
        <a href="/photos/<%= photo.id %>/edit" class="btn btn-warning">Edit</a>
        <a href="/delete_photo/<%= photo.id %>" class="btn btn-danger" rel="nofollow">Delete</a>

      <% end %>
    </tr>
    </div>
  </div>
</div>
<% end %>
</div>
